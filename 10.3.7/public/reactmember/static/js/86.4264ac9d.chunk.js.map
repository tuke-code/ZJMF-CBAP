{"version":3,"file":"static/js/86.4264ac9d.chunk.js","mappings":"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","sources":["api/image.js","views/product/image/backup/Backup.jsx"],"sourcesContent":["import request from '../utils/request'\r\n\r\n/* 实例列表 */\r\nexport function getCloudList(params) {\r\n    return request.get(`/idcsmart_cloud`, { params });\r\n}\r\n\r\n/* 获取所有产品 */\r\nexport function getCloudListAll() {\r\n    return request.get(`/idcsmart_cloud/all`);\r\n}\r\n\r\n\r\n// 获取实例磁盘\r\nexport function getDiskList(id) {\r\n    return request.get(`/idcsmart_cloud/${id}/disk`);\r\n}\r\n\r\n// 快照\r\n// 快照列表\r\nexport function snapshotList() {\r\n    return request.get(`/snapshot`)\r\n}\r\n\r\n// 创建快照\r\nexport function createSnapshot(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/snapshot`,params)\r\n}\r\n\r\n// 快照还原\r\nexport function restoreSnapshot(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/snapshot/restore`,params)\r\n}\r\n// 删除快照\r\nexport function delSnapshot(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/snapshot/${params.snapshot_id}`,params)\r\n}\r\n\r\n\r\n// 备份\r\n// 备份列表\r\nexport function backupList() {\r\n    return request.get(`/backup`)\r\n}\r\n\r\n// 删除备份\r\nexport function delBackup(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/backup/${params.backup_id}`,params)\r\n}\r\n\r\n// 备份还原\r\nexport function restoreBackup(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/backup/restore`,params)\r\n}\r\n\r\n// 创建快照\r\nexport function createBackup(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/backup`,params)\r\n}\r\n\r\n// 模板\r\n// 模板列表\r\nexport function templateList() {\r\n    return request.get(`/template`)\r\n}\r\n\r\n// 创建模板\r\nexport function createTemplate(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/template`,params)\r\n}\r\n\r\n// 删除模板\r\nexport function delTemplate(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/template/${params.template_id}`,params)\r\n}\r\n\r\n// iso\r\n// iso列表\r\nexport function isoList() {\r\n    return request.get(`/iso`)\r\n}","import React, { useState, useEffect } from 'react'\r\nimport './backup.less'\r\nimport { Table, Popover, Alert, Button, Modal, Row, Col, Input, Select, } from 'antd';\r\nimport {\r\n  EllipsisOutlined\r\n} from '@ant-design/icons';\r\nimport { backupList, getDiskList, getCloudListAll, delBackup, restoreBackup, createBackup } from '@/api/image'\r\nimport Swal from \"sweetalert2\";\r\nimport { showDialog } from '@/utils/util';\r\nimport moment from 'moment';\r\nimport { useTranslation } from \"react-i18next\";\r\n\r\nexport default function Backup() {\r\n  const { t } = useTranslation()\r\n  const { Option } = Select;\r\n  // 数据相关\r\n  const [diskList, setDiskList] = useState([])\r\n  const [sForm, setSForm] = useState({\r\n    id: 0,\r\n    name: null,\r\n    disk_id: null\r\n  })\r\n  // 实例列表\r\n  const [cloudList, setCloudList] = useState([])\r\n  const [selectLoading, setSelectLoading] = useState(false)\r\n  // 立即创建 按钮 loading\r\n  const [createBtnLoading, setCreateBtnLoading] = useState(false)\r\n  const [errMsg, setErrMsg] = useState(\"\")\r\n  const [visible, setVisible] = useState(false)\r\n  const [data, setData] = useState([\r\n    // {\r\n    //   id: 0,\r\n    //   name: '备份1',\r\n    //   area: '中国',\r\n    //   create_time: '1231789',\r\n    //   host_name: '实例1',\r\n    //   country: '中国',\r\n    //   country_code: 'CN',\r\n    //   city: '重庆',\r\n    // },\r\n    // {\r\n    //   id: 1,\r\n    //   name: '备份2',\r\n    //   area: '中国',\r\n    //   create_time: '1231789',\r\n    //   host_name: '实例2',\r\n    //   country: '中国',\r\n    //   city: '重庆',\r\n    // }\r\n  ])\r\n  const columns = [\r\n    {\r\n      title: \"名称\",\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      ellipsis: true,\r\n      width: 200\r\n    },\r\n    {\r\n      title: \"创建时间\",\r\n      dataIndex: 'create_time',\r\n      key: 'create_time',\r\n      ellipsis: true,\r\n      width: 200,\r\n      render: (create_time) => (\r\n        <>\r\n          {moment(create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"实例\",\r\n      dataIndex: 'host_name',\r\n      key: 'host_name',\r\n      ellipsis: true,\r\n      minWidth: 400,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"host\">\r\n            <span className=\"host-name\">\r\n              {record.host_name ? record.host_name : '--'}\r\n            </span>\r\n            <span className='host-ip'>\r\n              {record.ip ? record.ip : '--'}\r\n            </span>\r\n          </div>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"区域\",\r\n      dataIndex: 'area',\r\n      key: 'area',\r\n      ellipsis: true,\r\n      width: 200,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"area\">\r\n            <img src={record.country_code && require(`@/assets/images/cloud/${record.country_code}.png`)} alt=\"\" />\r\n            <span className='country'>{record.country ? record.country : null}</span>\r\n            <span className='city'>{record.city ? record.city : null}</span>\r\n            <span className='area'>{record.area ? record.area : null}</span>\r\n          </div>\r\n\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      dataIndex: 'id',\r\n      key: 'id',\r\n      width: 80,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"com-opt-pop\" id={'com-opt' + record.id}>\r\n            <Popover getPopupContainer={() => document.getElementById('com-opt' + record.id)}\r\n              content={\r\n                <>\r\n                  <p className=\"cloud-opt\" onClick={() => recoverItem(record)}>恢复</p>\r\n                  <p className=\"cloud-opt\" onClick={() => deleteItem(record)}>{t(\"common.delete\")}</p>\r\n                </>\r\n              } placement=\"topRight\">\r\n              <p className=\"opt-icon\"><EllipsisOutlined /></p>\r\n            </Popover>\r\n          </div>\r\n        </>\r\n      )\r\n    },\r\n  ]\r\n  const [loading, setLoading] = useState(false)\r\n\r\n\r\n  // 方法开始\r\n  // 获取备份列表\r\n  const getBackupList = () => {\r\n    setLoading(true)\r\n    backupList().then(res => {\r\n      setLoading(false)\r\n      setData(res.data.list)\r\n    })\r\n  }\r\n\r\n  // 恢复\r\n  const recoverItem = (record) => {\r\n    Swal.fire({\r\n      title: `<p style='display:flex;font-size:18px'>恢复</p>`,\r\n      html: `\r\n      <div style='display:flex;flex-direction: column;'>\r\n        <span>您将恢复实例 ${record.host_name} 的磁盘</span>\r\n        <span>${moment(record.create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}创建的备份</span>\r\n        <span>当前所有数据丢失，请确认您需要恢复备份</span>\r\n      </div>\r\n      `,\r\n      showCancelButton: true,\r\n      confirmButtonColor: '#5C5EE4',\r\n      confirmButtonText: '确认',\r\n      cancelButtonText: '取消',\r\n      customClass: {\r\n        cancelButton: 'snapshot-cancel-button',\r\n      }\r\n    }).then(result => {\r\n      if (result.value) {\r\n        // 调用恢复 备份\r\n        const params = {\r\n          id: record.host_id,\r\n          backup_id: record.id\r\n        }\r\n        restoreBackup(params).then(res => {\r\n          if (res.data.status === 200) {\r\n            showDialog(`您已成功还原 ${record.name}`, \"success\")\r\n            getBackupList()\r\n          }\r\n        }).catch(error => {\r\n          showDialog(error.data.msg, \"error\")\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  // 删除\r\n  const deleteItem = (record) => {\r\n    Swal.fire({\r\n      html: `      \r\n      <div style='display:flex;flex-direction: column;'>\r\n        <span>您将删除实例 ${record.host_name} 的磁盘</span>\r\n        <span>${moment(record.create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}创建的备份</span>\r\n        <span>当前所有数据丢失，请确认您需要删除备份</span>\r\n      </div>`,\r\n      icon: 'info',\r\n      showCancelButton: true,\r\n      confirmButtonColor: '#5C5EE4',\r\n      confirmButtonText: '立即删除',\r\n      cancelButtonText: '取消',\r\n      customClass: {\r\n        icon: 'snapshot-del-icon',\r\n        cancelButton: 'snapshot-cancel-button',\r\n      }\r\n    }).then((result) => {\r\n      if (result.value) {\r\n        // 调用接口执行卸载\r\n        const params = {\r\n          id: record.host_id,\r\n          backup_id: record.id\r\n        }\r\n        delBackup(params).then(res => {\r\n          if (res.data.status === 200) {\r\n            doDelBack(record.name)\r\n\r\n          }\r\n        })\r\n      }\r\n    }).catch(error => {\r\n      showDialog(error.data.msg, \"error\")\r\n    })\r\n  }\r\n\r\n  const doDelBack = (name) => {\r\n    showDialog(`您已成功删除 ${name}`, \"success\")\r\n    getBackupList()\r\n  }\r\n\r\n  // 创建备份\r\n  const doCreateBackup = () => {\r\n    let isPass = true\r\n    if (!sForm.id) {\r\n      isPass = false\r\n      setErrMsg(\"请选择需要创建备份的实例\")\r\n    }\r\n\r\n    if (!sForm.disk_id) {\r\n      isPass = false\r\n      setErrMsg(\"请选择需要创建备份的磁盘\")\r\n    }\r\n\r\n    if (!sForm.name) {\r\n      isPass = false\r\n      setErrMsg(\"请输入备份名称\")\r\n    } else {\r\n      if (sForm.name.length > 10) {\r\n        isPass = false\r\n        setErrMsg(\"备份名称长度应不大于10\")\r\n      }\r\n    }\r\n\r\n    if (isPass) {\r\n      // 执行创建备份接口\r\n      const params = {\r\n        ...sForm\r\n      }\r\n      setCreateBtnLoading(true)\r\n      createBackup(params).then(res => {\r\n        setCreateBtnLoading(false)\r\n        if (res.data.status === 200) {\r\n          showDialog(res.data.msg, \"success\")\r\n          // 重新获取备份列表\r\n          getBackupList()\r\n          // 关闭 创建弹窗\r\n          setVisible(false)\r\n        }\r\n      }).catch(error => {\r\n        setCreateBtnLoading(false)\r\n        setErrMsg(error.data.msg)\r\n      })\r\n    }\r\n  }\r\n\r\n  // 实例切换\r\n  const changeCloud = (e) => {\r\n    // 获取磁盘\r\n    doGetDiskList(e)\r\n  }\r\n\r\n  // 获取磁盘列表\r\n  const doGetDiskList = (id) => {\r\n    setSelectLoading(true)\r\n    getDiskList(id).then(res => {\r\n      setSelectLoading(false)\r\n      setDiskList(res.data.list)\r\n      if (res.data.list[0]) {\r\n        setSForm({\r\n          ...sForm,\r\n          disk_id: Number(res.data.list[0].id),\r\n          id\r\n        });\r\n      } else {\r\n        setSForm({\r\n          ...sForm,\r\n          disk_id: null,\r\n          id\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      setSelectLoading(false)\r\n    })\r\n  }\r\n\r\n  // 获取磁盘id\r\n  const getDiskIdValue = (e) => {\r\n    setSForm({\r\n      ...sForm,\r\n      disk_id: Number(e)\r\n    });\r\n  };\r\n  // 获取 备份名称\r\n  const getNameValue = (e) => {\r\n    setSForm({\r\n      ...sForm,\r\n      name: e.target.value,\r\n    })\r\n  }\r\n\r\n  // 打开创建备份弹窗\r\n  const showVisible = () => {\r\n\r\n    // 初始化 表单数据\r\n    setSForm({\r\n      id: cloudList[0] ? cloudList[0].id : null,\r\n      name: null,\r\n      disk_id: diskList[0] ? diskList[0].id : null\r\n    })\r\n    if (cloudList[0]) {\r\n      doGetDiskList(cloudList[0].id)\r\n    }\r\n    setErrMsg(\"\")\r\n    setVisible(true)\r\n  }\r\n\r\n  // 获取实例列表\r\n  const doGetCloudList = () => {\r\n    getCloudListAll().then(res => {\r\n      if (res.data.status === 200) {\r\n        const list = res.data.data.list.reverse()\r\n        if (list[0]) {\r\n          doGetDiskList(list[0].id)\r\n        }\r\n        setCloudList(list)\r\n      }\r\n    })\r\n  }\r\n\r\n  useEffect(() => {\r\n    getBackupList()\r\n    // 获取实例列表\r\n    doGetCloudList()\r\n  }, [])\r\n\r\n  return (\r\n    <div className='Snapshot'>\r\n      <div className=\"top\">\r\n        <div className=\"top-text\">\r\n          快速将磁盘数据进行备份，一旦重装/实例删除，所有备份丢失\r\n        </div>\r\n        <div className=\"top-btn\" onClick={showVisible}>创建备份</div>\r\n      </div>\r\n      <div className=\"snapshot-table\">\r\n        <Table pagination={false} rowKey={record => record.id} loading={loading} columns={columns} dataSource={data}></Table>\r\n      </div>\r\n      {/* 创建备份弹窗 */}\r\n\r\n      <Modal\r\n        visible={visible}\r\n        footer={null}\r\n        centered={true}\r\n        closable={false}\r\n        style={{ borderRadius: \"10px\", overflow: \"auto\" }}\r\n        getContainer={false}\r\n        onCancel={() => setVisible(false)}\r\n      >\r\n        <div className='create-snapshot'>\r\n          <div className=\"top\">\r\n            <div className=\"title\">\r\n              创建备份\r\n            </div>\r\n          </div>\r\n          <div className=\"main\">\r\n            {\r\n              errMsg ?\r\n                <div className=\"err\">\r\n                  <Alert description={errMsg} type=\"error\" showIcon />\r\n                </div>\r\n                :\r\n                <div className=\"remind-text\">\r\n                  建议您关闭实例后创建备份，确保一致性避免出现问题，备份基于数量收费\r\n                </div>\r\n            }\r\n            <div className=\"form\">\r\n              <div className=\"row\">\r\n                <Row>\r\n                  <Col span={4}>\r\n                    <span className='label'>磁盘</span>\r\n                  </Col>\r\n                  <Col span={10}>\r\n                    <Select size='large'\r\n                      placeholder=\"请选择实例\"\r\n                      onChange={changeCloud}\r\n                      defaultValue={cloudList[0] ? cloudList[0].id : ''}\r\n                    >\r\n                      {\r\n                        cloudList.map(item => {\r\n                          return (<Option value={item.id} key={item.id}>{item.name}</Option>)\r\n                        })\r\n                      }\r\n                    </Select>\r\n                  </Col>\r\n                  <Col span={10}>\r\n                    <Select size='large' onChange={getDiskIdValue} value={sForm.disk_id} defaultValue={diskList[0] ? diskList[0].id : ''} placeholder=\"请选择磁盘\" loading={selectLoading} >\r\n                      {\r\n                        diskList.map(item => {\r\n                          return <Option key={item.id} value={item.id}>{`${item.name}-${item.size}G`}</Option>\r\n                        })\r\n                      }\r\n                    </Select>\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n              <div className=\"row\">\r\n                <Row>\r\n                  <Col span={4}>\r\n                    <span className='label'>名称</span>\r\n                  </Col>\r\n                  <Col span={20}>\r\n                    <Input size='large' placeholder=\"请输入备份名称\" onChange={getNameValue} />\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"footer\">\r\n            <Button className='sub-btn' onClick={doCreateBackup} loading={createBtnLoading}>立即创建</Button>\r\n            <Button className='cancel-btn' onClick={() => setVisible(false)}>取消</Button>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["getCloudListAll","request","getDiskList","id","snapshotList","createSnapshot","params","restoreSnapshot","delSnapshot","snapshot_id","backupList","delBackup","backup_id","restoreBackup","createBackup","templateList","createTemplate","delTemplate","template_id","isoList","Backup","t","useTranslation","Option","Select","useState","diskList","setDiskList","name","disk_id","sForm","setSForm","cloudList","setCloudList","selectLoading","setSelectLoading","createBtnLoading","setCreateBtnLoading","errMsg","setErrMsg","visible","setVisible","data","setData","columns","title","dataIndex","key","ellipsis","width","render","create_time","moment","format","minWidth","_","record","className","host_name","ip","src","country_code","require","alt","country","city","area","getPopupContainer","document","getElementById","content","onClick","recoverItem","deleteItem","placement","EllipsisOutlined","loading","setLoading","getBackupList","then","res","list","Swal","html","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","customClass","cancelButton","result","value","host_id","status","showDialog","catch","error","msg","icon","doDelBack","doGetDiskList","Number","useEffect","reverse","pagination","rowKey","dataSource","footer","centered","closable","style","borderRadius","overflow","getContainer","onCancel","description","type","showIcon","span","size","placeholder","onChange","e","defaultValue","map","item","target","isPass","length"],"sourceRoot":""}