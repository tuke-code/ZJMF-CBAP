{"version":3,"file":"static/js/857.6b4f2874.chunk.js","mappings":"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","sources":["views/product/storage/ExpansionStorage.jsx"],"sourcesContent":["import React, { useState, useEffect, useReducer, useRef, useCallback } from \"react\";\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { useNavigate, useSearchParams } from \"react-router-dom\";\r\nimport { showDialog } from '@/utils/util'\r\nimport {\r\n  Col, Row, message, Input, Form, Select, Popover, Checkbox\r\n} from \"antd\";\r\nimport { MinusCircleOutlined } from \"@ant-design/icons\";\r\nimport './CreateStorage.less'\r\nimport * as cloud from \"@/api/cloud\";\r\nimport { expansionStorage, getCloudById, settle, getDurationPrice, configPackage, diskPackage } from '@/api/storage'\r\nimport PayModal from \"@/components/payModal/PayModal\";\r\nconst { Option } = Select;\r\n\r\nvar inputTimer = null\r\nexport default function CreateStorage() {\r\n  const [search] = useSearchParams();\r\n  // 硬盘id\r\n  const id = search.get(\"id\");\r\n  // 实例id\r\n  const host_id = search.get(\"host_id\");\r\n  // 套餐id\r\n  const package_id = search.get(\"package_id\");\r\n  // 原先的磁盘容量\r\n  const size = search.get(\"size\");\r\n\r\n\r\n  // 定时器\r\n  const [timer, setTimer] = useState(null);\r\n  // 轮询剩余时间\r\n  const [time, setTime] = useState(300000); // 5分钟\r\n  const navigate = useNavigate()\r\n  const { t } = useTranslation()\r\n\r\n\r\n  // 周期列表\r\n  const [cycleList, setCycleList] = useState([])\r\n  // 表单数据\r\n  const [form] = Form.useForm()\r\n  const [formData, setFormData] = useState({\r\n    qty: 1,\r\n    size,\r\n    type_id: package_id\r\n  })\r\n  // 支付相关\r\n  const [isShowPay, setIsShowPay] = useState(false)\r\n  const [orderId, setOrderId] = useState('')\r\n\r\n\r\n  // 底部 相关\r\n\r\n  // 优惠码弹窗\r\n  const [disVisible, setDisVisible] = useState(false);\r\n  const disRef = useRef();\r\n  const [disInput, setDisinput] = useState(\"\");\r\n  // 公共配置\r\n  const [common] = useState(JSON.parse(localStorage.getItem('font_config')))\r\n  // 实例详情\r\n  const [center, setCenter] = useState()\r\n  // 价格展示\r\n  const [price, setPrice] = useState({});\r\n  // 优惠码列表\r\n  const [discountList, setDiscountList] = useState([]);\r\n  // 容量允许范围\r\n  const [sizeRange, setSizeRange] = useState()\r\n  // 周期select的值\r\n  const [cycleSelectValue, setCycleSelectValue] = useState(1)\r\n\r\n  // 磁盘升降级配置数据\r\n  const [diskPackageData, setDiskPackageData] = useState([])\r\n\r\n  // 当前周期数组选中的index\r\n  const [sizeIndex, setSizeIndex] = useState(0)\r\n  // 20G\r\n  const [size20, setSize20] = useState([])\r\n  // 50G\r\n  const [size50, setSize50] = useState([])\r\n  // 100G\r\n  const [size100, setSize100] = useState([])\r\n  // 200G\r\n  const [size200, setSize200] = useState([])\r\n  // 500G\r\n  const [size500, setSize500] = useState([])\r\n\r\n\r\n  /* 实例 */\r\n\r\n  // 切换周期\r\n  const changeCycle = (e) => {\r\n    setFormData({ ...formData, duration_price_id: e })\r\n    setCycleSelectValue(e)\r\n\r\n    // 获取周期的index\r\n    const index = cycleList.findIndex(item => {\r\n      return item.id == e\r\n    })\r\n    setSizeIndex(index)\r\n\r\n    // 获取价格 和价格周期\r\n    const cycle = cycleList.filter(item => item.id == e)\r\n    setPrice({\r\n      price: cycle[0].price,\r\n      billing_cycle: cycle[0].display_name\r\n    })\r\n  }\r\n\r\n\r\n  // 获取磁盘升级级配置信息\r\n  const getDiskPackage = () => {\r\n    const params = {\r\n      id\r\n    }\r\n    diskPackage(params).then(res => {\r\n      if (res.data.status === 200) {\r\n        let data = res.data.data.package\r\n        // 存储磁盘升降级数据\r\n        setDiskPackageData(data)\r\n        // 获取磁盘容量范围\r\n        data.some(n => {\r\n          if (n.id == package_id) {\r\n            // 设置当前套餐的 容量范围\r\n            // console.log(n);\r\n            setSizeRange({\r\n              size_min: n.size_min,\r\n              size_max: n.size_max\r\n            })\r\n            // 获取区域信息\r\n            setCenter(n)\r\n          }\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n\r\n  // 磁盘容量变化\r\n  const sizeChange = (e) => {\r\n    if (inputTimer) {\r\n      clearTimeout(inputTimer)\r\n    }\r\n\r\n    inputTimer = setTimeout(() => {\r\n      const value = e.target.value\r\n      // 判断容量是否合规\r\n      if (value < sizeRange.size_min || value > sizeRange.size_max) {\r\n        return false\r\n      } else {\r\n        setFormData({ ...formData, size: value })\r\n        // 获取周期信息\r\n        doGetDurationPrice()\r\n        // 初始化优惠码\r\n        setDiscountList([])\r\n      }\r\n    }, 500)\r\n\r\n  }\r\n\r\n\r\n  // 获取 20G、50G、100G、200G、500G的周期价格\r\n  const doGetFiveDurationPrice = (package_id) => {\r\n    const ex = [20, 50, 100, 200, 500]\r\n    ex.forEach(size => {\r\n      const params = {\r\n        package_id,\r\n        size\r\n      }\r\n      getDurationPrice(params).then(res => {\r\n        if (res.data.status == 200) {\r\n          const list = res.data.data.list\r\n          if (size == 20) {\r\n            setSize20(list)\r\n          }\r\n          if (size == 50) {\r\n            setSize50(list)\r\n          }\r\n          if (size == 100) {\r\n            setSize100(list)\r\n          }\r\n          if (size == 200) {\r\n            setSize200(list)\r\n          }\r\n          if (size == 500) {\r\n            setSize500(list)\r\n          }\r\n        }\r\n      })\r\n    })\r\n  }\r\n\r\n\r\n\r\n  // 底部方法\r\n  // 优惠码 确定按钮\r\n  const closeDiscount = async () => {\r\n    try {\r\n      const value = disRef.current.input.value;\r\n      if (!value) {\r\n        return false;\r\n      }\r\n      // 不能相同优惠码\r\n      if (discountList.find(item => item.name === value)) {\r\n        return showDialog(t(\"cloud.tip31\"), 'error')\r\n      }\r\n      // 使用过的优惠码包含不可叠加的\r\n      if (discountList.find(item => !item.overlay)) {\r\n        return showDialog(t(\"cloud.tip32\"), 'error')\r\n      }\r\n      const res = await cloud.usePromoCode({\r\n        promo_code: value,\r\n        scene: \"New\",\r\n        total: Number(price.price),\r\n        cycles: [\r\n          {\r\n            product_id: formData.product_id,\r\n            amount: price.price,\r\n            billing_cycle_time: price.duration,\r\n          },\r\n        ],\r\n      });\r\n      if (res.data.status === 200) {\r\n        const { overlay, discount } = res.data.data\r\n        // 如果之前有使用过优惠码，当前优惠码不可叠加的时候不能使用\r\n        if (discountList.length > 0 && !overlay) {\r\n          return showDialog(t(\"cloud.tip32\"), 'error')\r\n        }\r\n        setDiscountList((discountList) => {\r\n          const temp = discountList;\r\n          discountList.push({ name: value, num: discount, overlay });\r\n          return temp;\r\n        });\r\n        setDisVisible(false);\r\n      }\r\n    } catch (error) {\r\n      message.error(error);\r\n    }\r\n  };\r\n  // 取消优惠码\r\n  const cancelDiscount = (index) => {\r\n    setDiscountList((discountList) => {\r\n      const temp = JSON.parse(JSON.stringify(discountList));\r\n      temp.splice(index, 1);\r\n      return temp;\r\n    });\r\n  };\r\n\r\n  // 获取周期价格\r\n  const doGetDurationPrice = () => {\r\n    // 容量改变时获取周期价格\r\n    const data = form.getFieldValue()\r\n    const params = {\r\n      package_id: package_id,\r\n      size: data.size,\r\n    }\r\n    getDurationPrice(params).then(res => {\r\n      if (res.data.status === 200 && res.data.data.list) {\r\n        const list = res.data.data.list\r\n        setCycleList(list)\r\n        setPrice({\r\n          price: list[sizeIndex].price,\r\n          billing_cycle: list[sizeIndex].display_name\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  // 容量周期item点击事件\r\n  const itemClick = (size) => {\r\n    form.setFieldsValue({\r\n      size\r\n    })\r\n    setFormData({\r\n      ...formData,\r\n      size\r\n    })\r\n    doGetDurationPrice()\r\n  }\r\n\r\n  /* 磁盘类型切换 */\r\n  const changeType = (e) => {\r\n    const id = e.target.getAttribute(\"data-id\");\r\n    setFormData({ ...formData, type_id: id })\r\n    form.setFieldsValue({\r\n      type_id: id\r\n    })\r\n    doGetFiveDurationPrice(id)\r\n    // 获取该磁盘的 最小容量和最大容量\r\n    diskPackageData.map(item => {\r\n      if (item.id == id) {\r\n        setSizeRange({\r\n          size_min: item.size_min,\r\n          size_max: item.size_max\r\n        })\r\n      }\r\n    })\r\n\r\n    // 获取周期信息\r\n    doGetDurationPrice()\r\n    // 初始化优惠码\r\n    setDiscountList([])\r\n  }\r\n\r\n\r\n  // 提交扩容磁盘\r\n  const create = () => {\r\n    form.validateFields().then(async res => {\r\n\r\n      const params = {\r\n        id,\r\n        size: res.size,\r\n        package_id\r\n      }\r\n      try {\r\n        // 生成订单号\r\n        const res = await expansionStorage(params)\r\n        if (res.data.status === 200) {\r\n          const id = res.data.data.id\r\n          setIsShowPay(true)\r\n          setOrderId(id)\r\n          // 轮询支付状态\r\n          pollingStatus(id);\r\n        }\r\n      } catch (error) {\r\n        message.error(error.data.msg)\r\n      }\r\n    }).catch(error => {\r\n\r\n    })\r\n  }\r\n\r\n  const handleVisibleChange = (newVisible) => {\r\n    setDisVisible(newVisible);\r\n    setDisinput(\"\");\r\n  };\r\n\r\n  const changeInput = (e) => {\r\n    setDisinput(e.target.value);\r\n  };\r\n\r\n  // 轮询支付状态\r\n  const pollingStatus = (id) => {\r\n    if (!timer) {\r\n      setTimer(\r\n        (timer) =>\r\n        (timer = setInterval(async () => {\r\n          const res = await cloud.getPayStatus(id ? id : orderId);\r\n          setTime((time) => {\r\n            return (time -= 2000);\r\n          });\r\n          if (res.data.code === \"Paid\") {\r\n            showDialog(res.data.msg, 'success', () => {\r\n              navigate(\"/storage\", { replace: true });\r\n            })\r\n            clearInterval(timer);\r\n            setIsShowPay(false);\r\n            return false;\r\n          }\r\n          // 支付成功或者5分钟到点清除定时器\r\n          if (res.code === \"Paid\" || time === 0) {\r\n            clearInterval(timer);\r\n            setIsShowPay(false);\r\n            return false;\r\n          }\r\n        }, 2000))\r\n      );\r\n    }\r\n  };\r\n  useEffect(async () => {\r\n    // 获取周期\r\n    doGetDurationPrice()\r\n    // 获取磁盘升降级配置\r\n    getDiskPackage()\r\n    // 获取固定容量的价格周期\r\n    doGetFiveDurationPrice(package_id)\r\n    return () => {\r\n      clearInterval(timer);\r\n    }\r\n  }, [])\r\n  return (\r\n    <div className='create-ip com-content'>\r\n      <div className='com-card'>\r\n        <div className=\"box data-center\">\r\n          <div className=\"com-tit\">\r\n            <h1 className=\"tit\">扩容磁盘</h1>\r\n          </div>\r\n        </div>\r\n        <div className=\"box vpc\">\r\n          <Form\r\n            name=\"vpc\"\r\n            layout=\"vertical\"\r\n            form={form}\r\n            initialValues={{\r\n              size,\r\n              type_id: package_id\r\n            }}\r\n          >\r\n\r\n            <Form.Item\r\n              label=\"磁盘类型\"\r\n              name=\"type_id\"\r\n              rules={[{\r\n                required: true,\r\n                message: \"请选择磁盘类型\"\r\n              }]}\r\n              style={{\r\n                marginBottom: 0,\r\n              }}\r\n            >\r\n              <Row gutter={{ xs: 8, sm: 16, md: 24, lg: 30 }}>\r\n                {\r\n                  diskPackageData.length > 0 ?\r\n                    diskPackageData.map(item => {\r\n                      if (item.id == package_id)\r\n                        return (\r\n                          <Col\r\n                            xs={{ span: 24 }}\r\n                            md={{ span: 12 }}\r\n                            lg={{ span: 8 }}\r\n                            key={item.id}\r\n                          >\r\n                            <div\r\n                              className={`item c-hover ${item.id == formData.type_id * 1 ? \"c-active\" : \"\"}`}\r\n                              onClick={changeType}\r\n                              data-id={item.id}\r\n                            >\r\n                              {item.name}\r\n                            </div>\r\n                          </Col>\r\n                        )\r\n                    })\r\n                    : null\r\n                }\r\n              </Row>\r\n            </Form.Item>\r\n\r\n\r\n            <Form.Item label=\"容量\"\r\n            >\r\n              <div className=\"size-main\">\r\n                <Form.Item name=\"size\" style={{\r\n                  display: 'inline-block', width: '1.67rem', marginBottom: 0\r\n                }}\r\n                  rules={[\r\n                    { required: true, message: \"请填写容量\" },\r\n                    // 检查容量是否合规\r\n                    {\r\n                      validator: (rule, value, callback) => {\r\n                        if ((value < sizeRange.size_min) || value > sizeRange.size_max) {\r\n                          // callback(`磁盘容量应该在${sizeRange.size_min}-${sizeRange.size_max}`)\r\n                          return Promise.reject(`磁盘容量应该在${sizeRange.size_min}-${sizeRange.size_max}`);\r\n                        } else {\r\n                          return Promise.resolve();\r\n                        }\r\n                      }\r\n                    }\r\n                  ]}\r\n                >\r\n                  <Input onChange={sizeChange} style={{ width: '1.57rem', height: '.44rem' }}></Input>\r\n                </Form.Item>\r\n                <span style={{\r\n                  display: 'inline-block',\r\n                  width: '24px',\r\n                  lineHeight: '32px',\r\n                  textAlign: 'center',\r\n                }}>GB</span>\r\n                <div className=\"size-content\">\r\n                  {\r\n                    size20.length > 0 ?\r\n                      <div className={`size-item ${formData.size == 20 ? 'active' : ''}`} onClick={() => { itemClick(20) }}>\r\n                        <div className=\"item-top\">{common.currency_prefix}{size20[sizeIndex].price}/{size20[sizeIndex].display_name}</div>\r\n                        <div className=\"item-bottom\">20GB</div>\r\n                      </div>\r\n                      : null\r\n                  }\r\n\r\n                  {\r\n                    size50.length > 0 ?\r\n                      <div className={`size-item ${formData.size == 50 ? 'active' : ''}`} onClick={() => { itemClick(50) }}>\r\n                        <div className=\"item-top\">{common.currency_prefix}{size50[sizeIndex].price}/{size50[sizeIndex].display_name}</div>\r\n                        <div className=\"item-bottom\">50GB</div>\r\n                      </div>\r\n                      : null\r\n                  }\r\n                  {\r\n                    size100.length > 0 ?\r\n                      <div className={`size-item ${formData.size == 100 ? 'active' : ''}`} onClick={() => { itemClick(100) }}>\r\n                        <div className=\"item-top\">{common.currency_prefix}{size100[sizeIndex].price}/{size100[sizeIndex].display_name}</div>\r\n                        <div className=\"item-bottom\">100GB</div>\r\n                      </div>\r\n                      : null\r\n                  }\r\n                  {\r\n                    size200.length > 0 ?\r\n                      <div className={`size-item ${formData.size == 200 ? 'active' : ''}`} onClick={() => { itemClick(200) }}>\r\n                        <div className=\"item-top\">{common.currency_prefix}{size200[sizeIndex].price}/{size200[sizeIndex].display_name}</div>\r\n                        <div className=\"item-bottom\">200GB</div>\r\n                      </div>\r\n                      : null\r\n                  }\r\n                  {\r\n                    size500.length > 0 ?\r\n                      <div className={`size-item ${formData.size == 500 ? 'active' : ''}`} onClick={() => { itemClick(500) }}>\r\n                        <div className=\"item-top\">{common.currency_prefix}{size500[sizeIndex].price}/{size500[sizeIndex].display_name}</div>\r\n                        <div className=\"item-bottom\">500GB</div>\r\n                      </div>\r\n                      : null\r\n                  }\r\n                </div>\r\n              </div>\r\n            </Form.Item>\r\n          </Form>\r\n        </div>\r\n      </div>\r\n      {/* 底部 */}\r\n      <div className=\"total-box\" >\r\n        <div className=\"content\">\r\n          <div className=\"item\">\r\n            <div className=\"l-config\">\r\n              <p className=\"tit\">{t(\"cloud.area\")}：</p>\r\n              {center && (\r\n                <p className=\"des\">\r\n                  <img\r\n                    src={require(`@/assets/images/cloud/${center.country_code}.png`)}\r\n                    alt=\"\"\r\n                    className=\"country\"\r\n                  />\r\n                  <span>\r\n                    {center.country}/{center.city} &nbsp; {center.area}\r\n                  </span>\r\n                </p>\r\n              )}\r\n            </div>\r\n          </div>\r\n          <div className=\"item\">\r\n            <div className=\"l-config\">\r\n              <p className=\"tit\">{t(\"common.cycle\")}：</p>\r\n\r\n              {\r\n                cycleList.length > 0 && <Select className='cycle' value={cycleSelectValue} onChange={changeCycle} defaultValue={cycleList[0].id}>\r\n                  {\r\n                    cycleList.map(item => {\r\n                      return (\r\n                        <Option value={item.id} key={item.price}>{common.currency_prefix}{item.price}/{item.display_name}</Option>\r\n                      )\r\n                    })\r\n                  }\r\n                </Select>\r\n              }\r\n\r\n            </div>\r\n          </div>\r\n          <div className=\"item\">\r\n            <div className=\"l-config\">\r\n              <div className=\"s-item\">\r\n                <p className=\"tit\">{t(\"common.total_price\")}：</p>\r\n                {price && (\r\n                  <>\r\n                    <p className=\"price\">\r\n                      {common.currency_prefix}\r\n                      <span className=\"num\">\r\n                        {String(\r\n                          (\r\n                            (price.price * formData.qty - discountList.reduce((sum, i) => (sum += i.num * 1), 0)) >= 0 ?\r\n                              (price.price * formData.qty - discountList.reduce((sum, i) => (sum += i.num * 1), 0)) : 0\r\n                          ).toFixed(2)\r\n                        )}\r\n                      </span>\r\n                      /{price.billing_cycle}\r\n                    </p>\r\n                    {/* 优惠码列表 */}\r\n                    <div className=\"discount-list\">\r\n                      {discountList.length > 0 &&\r\n                        discountList.map((item, index) => {\r\n                          return (\r\n                            <p className=\"item\" key={item.name}>\r\n                              <span className=\"num\">-¥{item.num}</span>\r\n                              <span>\r\n                                ({t(\"common.discount_code\") + item.name})\r\n                                <MinusCircleOutlined\r\n                                  onClick={() => cancelDiscount(index)}\r\n                                />\r\n                              </span>\r\n                            </p>\r\n                          );\r\n                        })}\r\n                    </div>\r\n                  </>\r\n                )}\r\n              </div>\r\n            </div>\r\n            <div className=\"config\">\r\n              <p className=\"tit\"></p>\r\n              <div className=\"bot\" id=\"bot\">\r\n                <Popover\r\n                  placement=\"bottomRight\"\r\n                  getPopupContainer={() => document.getElementById(\"bot\")}\r\n                  content={\r\n                    <div className=\"discount\">\r\n                      <Input\r\n                        placeholder={t(\"cloud.input_discount_code\")}\r\n                        value={disInput}\r\n                        ref={disRef}\r\n                        onChange={changeInput}\r\n                      ></Input>\r\n                      <span className=\"close\" onClick={closeDiscount}>\r\n                        {t(\"common.sure\")}\r\n                      </span>\r\n                    </div>\r\n                  }\r\n                  trigger=\"click\"\r\n                  visible={disVisible}\r\n                  onVisibleChange={handleVisibleChange}\r\n                >\r\n                  <span className=\"discount_code\">\r\n                    {t(\"common.discount_code\")}\r\n                  </span>\r\n                </Popover>\r\n                <div className=\"r-btn\">\r\n                  <p className=\"checkout\" onClick={create}>\r\n                    创建并购买\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* 支付modal */}\r\n      {\r\n        isShowPay && orderId &&\r\n        (\r\n          <PayModal orderId={orderId} timer={timer}></PayModal>\r\n        )\r\n      }\r\n    </div>\r\n  )\r\n}\r\n"],"names":["Option","Select","inputTimer","CreateStorage","useSearchParams","search","id","get","package_id","size","useState","timer","setTimer","time","setTime","navigate","useNavigate","t","useTranslation","cycleList","setCycleList","Form","form","qty","type_id","formData","setFormData","isShowPay","setIsShowPay","orderId","setOrderId","disVisible","setDisVisible","disRef","useRef","disInput","setDisinput","JSON","parse","localStorage","getItem","common","center","setCenter","price","setPrice","discountList","setDiscountList","sizeRange","setSizeRange","cycleSelectValue","setCycleSelectValue","diskPackageData","setDiskPackageData","sizeIndex","setSizeIndex","size20","setSize20","size50","setSize50","size100","setSize100","size200","setSize200","size500","setSize500","getDiskPackage","params","diskPackage","then","res","data","status","package","some","n","size_min","size_max","doGetFiveDurationPrice","forEach","getDurationPrice","list","closeDiscount","value","current","input","find","item","name","showDialog","overlay","cloud","promo_code","scene","total","Number","cycles","product_id","amount","billing_cycle_time","duration","discount","length","temp","push","num","message","doGetDurationPrice","getFieldValue","billing_cycle","display_name","itemClick","setFieldsValue","changeType","e","target","getAttribute","map","pollingStatus","setInterval","code","msg","replace","clearInterval","useEffect","className","layout","initialValues","label","rules","required","style","marginBottom","gutter","xs","sm","md","lg","span","onClick","display","width","validator","rule","callback","Promise","reject","resolve","onChange","clearTimeout","setTimeout","height","lineHeight","textAlign","currency_prefix","src","require","country_code","alt","country","city","area","duration_price_id","index","findIndex","cycle","filter","defaultValue","String","reduce","sum","i","toFixed","stringify","splice","cancelDiscount","placement","getPopupContainer","document","getElementById","content","placeholder","ref","trigger","visible","onVisibleChange","newVisible","validateFields","expansionStorage","catch","error"],"sourceRoot":""}