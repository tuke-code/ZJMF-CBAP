{"version":3,"file":"static/js/640.94dbc621.chunk.js","mappings":"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","sources":["api/image.js","views/product/image/snapshot/Snapshot.jsx"],"sourcesContent":["import request from '../utils/request'\r\n\r\n/* 实例列表 */\r\nexport function getCloudList(params) {\r\n    return request.get(`/idcsmart_cloud`, { params });\r\n}\r\n\r\n/* 获取所有产品 */\r\nexport function getCloudListAll() {\r\n    return request.get(`/idcsmart_cloud/all`);\r\n}\r\n\r\n\r\n// 获取实例磁盘\r\nexport function getDiskList(id) {\r\n    return request.get(`/idcsmart_cloud/${id}/disk`);\r\n}\r\n\r\n// 快照\r\n// 快照列表\r\nexport function snapshotList() {\r\n    return request.get(`/snapshot`)\r\n}\r\n\r\n// 创建快照\r\nexport function createSnapshot(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/snapshot`,params)\r\n}\r\n\r\n// 快照还原\r\nexport function restoreSnapshot(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/snapshot/restore`,params)\r\n}\r\n// 删除快照\r\nexport function delSnapshot(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/snapshot/${params.snapshot_id}`,params)\r\n}\r\n\r\n\r\n// 备份\r\n// 备份列表\r\nexport function backupList() {\r\n    return request.get(`/backup`)\r\n}\r\n\r\n// 删除备份\r\nexport function delBackup(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/backup/${params.backup_id}`,params)\r\n}\r\n\r\n// 备份还原\r\nexport function restoreBackup(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/backup/restore`,params)\r\n}\r\n\r\n// 创建快照\r\nexport function createBackup(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/backup`,params)\r\n}\r\n\r\n// 模板\r\n// 模板列表\r\nexport function templateList() {\r\n    return request.get(`/template`)\r\n}\r\n\r\n// 创建模板\r\nexport function createTemplate(params){\r\n    return request.post(`/idcsmart_cloud/${params.id}/template`,params)\r\n}\r\n\r\n// 删除模板\r\nexport function delTemplate(params){\r\n    return request.delete(`/idcsmart_cloud/${params.id}/template/${params.template_id}`,params)\r\n}\r\n\r\n// iso\r\n// iso列表\r\nexport function isoList() {\r\n    return request.get(`/iso`)\r\n}","import React, { useState, useEffect } from 'react'\r\nimport './snapshot.less'\r\nimport { Table, Popover, Alert, Button, Modal, Row, Col, Input, Select, } from 'antd';\r\nimport {\r\n  EllipsisOutlined\r\n} from '@ant-design/icons';\r\nimport { snapshotList, getCloudListAll, getDiskList, delSnapshot, restoreSnapshot } from '@/api/image'\r\nimport Swal from \"sweetalert2\";\r\nimport { showDialog } from '@/utils/util';\r\nimport moment from 'moment';\r\nimport { useTranslation } from \"react-i18next\";\r\nimport { createSnapshot } from '../../../../api/image';\r\n\r\nexport default function Snapshot() {\r\n  const { t } = useTranslation()\r\n  const { Option } = Select;\r\n  // 数据相关\r\n  // 实例列表\r\n  const [cloudList, setCloudList] = useState([])\r\n  const [diskList, setDiskList] = useState([])\r\n  const [sForm, setSForm] = useState({\r\n    id: 0,\r\n    name: null,\r\n    disk_id: null\r\n  })\r\n  const [selectLoading, setSelectLoading] = useState(false)\r\n  // 立即创建 按钮 loading\r\n  const [createBtnLoading, setCreateBtnLoading] = useState(false)\r\n  const [errMsg, setErrMsg] = useState(\"\")\r\n  const [visible, setVisible] = useState(false)\r\n  const [data, setData] = useState([])\r\n  const columns = [\r\n    {\r\n      title: \"名称\",\r\n      dataIndex: 'name',\r\n      key: 'name',\r\n      ellipsis: true,\r\n      width: 200\r\n    },\r\n    {\r\n      title: \"创建时间\",\r\n      dataIndex: 'create_time',\r\n      key: 'create_time',\r\n      ellipsis: true,\r\n      width: 200,\r\n      render: (create_time) => (\r\n        <>\r\n          {moment(create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"实例\",\r\n      dataIndex: 'host_name',\r\n      key: 'host_name',\r\n      ellipsis: true,\r\n      minWidth: 400,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"host\">\r\n            <span className=\"host-name\">\r\n              {record.host_name ? record.host_name : '--'}\r\n            </span>\r\n            <span className='host-ip'>\r\n              {record.ip ? record.ip : '--'}\r\n            </span>\r\n          </div>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"区域\",\r\n      dataIndex: 'area',\r\n      key: 'area',\r\n      ellipsis: true,\r\n      width: 200,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"area\">\r\n            <img src={record.country_code && require(`@/assets/images/cloud/${record.country_code}.png`)} alt=\"\" />\r\n            <span className='country'>{record.country ? record.country : null}</span>\r\n            <span className='city'>{record.city ? record.city : null}</span>\r\n            <span className='area'>{record.area ? record.area : null}</span>\r\n          </div>\r\n        </>\r\n      )\r\n    },\r\n    {\r\n      title: \"操作\",\r\n      dataIndex: 'id',\r\n      key: 'id',\r\n      width: 80,\r\n      render: (_, record) => (\r\n        <>\r\n          <div className=\"com-opt-pop\" id={'com-opt' + record.id}>\r\n            <Popover getPopupContainer={() => document.getElementById('com-opt' + record.id)}\r\n              content={\r\n                <>\r\n                  <p className=\"cloud-opt\" onClick={() => recoverItem(record)}>恢复</p>\r\n                  <p className=\"cloud-opt\" onClick={() => deleteItem(record)}>{t(\"common.delete\")}</p>\r\n                </>\r\n              } placement=\"topRight\">\r\n              <p className=\"opt-icon\"><EllipsisOutlined /></p>\r\n            </Popover>\r\n          </div>\r\n        </>\r\n      )\r\n    },\r\n  ]\r\n  const [loading, setLoading] = useState(false)\r\n\r\n\r\n  // 方法开始\r\n\r\n\r\n  // 获取实例列表\r\n  const doGetCloudList = () => {\r\n    getCloudListAll().then(res => {\r\n      if (res.data.status === 200) {\r\n        const list = res.data.data.list.reverse()\r\n        if (list[0]) {\r\n          doGetDiskList(list[0].id)\r\n        }\r\n        setCloudList(list)\r\n      }\r\n    })\r\n  }\r\n\r\n  // 获取快照列表\r\n  const getSnapshotList = () => {\r\n    setLoading(true)\r\n    snapshotList().then(res => {\r\n      setLoading(false)\r\n      setData(res.data.list)\r\n    })\r\n  }\r\n\r\n  // 恢复\r\n  const recoverItem = (record) => {\r\n    Swal.fire({\r\n      title: `<p style='display:flex;font-size:18px'>恢复</p>`,\r\n      html: `\r\n      <div style='display:flex;flex-direction: column;'>\r\n        <span>您将恢复实例 ${record.host_name} 的磁盘</span>\r\n        <span>${moment(record.create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}创建的快照</span>\r\n        <span>当前所有数据丢失，请确认您需要恢复快照</span>\r\n      </div>\r\n      `,\r\n      showCancelButton: true,\r\n      confirmButtonColor: '#5C5EE4',\r\n      confirmButtonText: '确认',\r\n      cancelButtonText: '取消',\r\n      customClass: {\r\n        cancelButton: 'snapshot-cancel-button',\r\n      }\r\n    }).then(result => {\r\n      if (result.value) {\r\n        // 调用恢复 快照\r\n        const params = {\r\n          id: record.host_id,\r\n          snapshot_id: record.id\r\n        }\r\n        restoreSnapshot(params).then(res => {\r\n          if (res.data.status === 200) {\r\n            showDialog(`您已成功还原 ${record.name}`, \"success\")\r\n            // 重新拉去快照列表\r\n            getSnapshotList()\r\n          }\r\n        }).catch(error => {\r\n          showDialog(error.data.msg, \"error\")\r\n        })\r\n      }\r\n    })\r\n  }\r\n\r\n  // 删除\r\n  const deleteItem = (record) => {\r\n    console.log(record);\r\n    Swal.fire({\r\n      html: `\r\n      <div style='display:flex;flex-direction: column;'>\r\n        <span>您将删除实例 ${record.host_name} 的磁盘</span>\r\n        <span>${moment(record.create_time * 1000).format(\"YYYY-MM-DD HH:mm\")}创建的快照</span>\r\n        <span>当前所有数据丢失，请确认您需要删除快照</span>\r\n      </div>\r\n      `,\r\n      icon: 'info',\r\n      showCancelButton: true,\r\n      confirmButtonColor: '#5C5EE4',\r\n      confirmButtonText: '立即删除',\r\n      cancelButtonText: '取消',\r\n      customClass: {\r\n        icon: 'snapshot-del-icon',\r\n        cancelButton: 'snapshot-cancel-button',\r\n      }\r\n    }).then((result) => {\r\n      if (result.value) {\r\n        // 调用接口执行删除\r\n        const params = {\r\n          id: record.host_id,\r\n          snapshot_id: record.id\r\n        }\r\n        // 调用删除 快照\r\n        delSnapshot(params).then(res => {\r\n          if (res.data.status === 200) {\r\n            // showDialog(`您已成功删除 ${record.name}`, \"success\")\r\n            // // 重新拉去快照列表\r\n            // getSnapshotList()\r\n            doDelBack(record.name)\r\n          }\r\n        })\r\n      }\r\n    }).catch(error => {\r\n      showDialog(error.data.msg, \"error\")\r\n    })\r\n  }\r\n\r\n\r\n  const doDelBack = (name) => {\r\n    showDialog(`您已成功删除 ${name}`, \"success\")\r\n    getSnapshotList()\r\n  }\r\n\r\n  // 创建快照\r\n  const doCreateSnapshot = () => {\r\n    let isPass = true\r\n    if (!sForm.id) {\r\n      isPass = false\r\n      setErrMsg(\"请选择需要创建快照的实例\")\r\n    }\r\n\r\n    if (!sForm.disk_id) {\r\n      isPass = false\r\n      setErrMsg(\"请选择需要创建快照的磁盘\")\r\n    }\r\n\r\n    if (!sForm.name) {\r\n      isPass = false\r\n      setErrMsg(\"请输入快照名称\")\r\n    } else {\r\n      if (sForm.name.length > 10) {\r\n        isPass = false\r\n        setErrMsg(\"快照名称长度应不大于10\")\r\n      }\r\n    }\r\n\r\n    if (isPass) {\r\n      // 执行创建快照接口\r\n      const params = {\r\n        ...sForm\r\n      }\r\n      setCreateBtnLoading(true)\r\n      createSnapshot(params).then(res => {\r\n        setCreateBtnLoading(false)\r\n        if (res.data.status === 200) {\r\n          showDialog(res.data.msg, \"success\")\r\n          // 关闭弹窗\r\n          setVisible(false)\r\n          // 重新获取快照列表\r\n          getSnapshotList()\r\n        }\r\n      }).catch(error => {\r\n        setCreateBtnLoading(false)\r\n        setErrMsg(error.data.msg)\r\n      })\r\n    }\r\n  }\r\n\r\n  // 获取磁盘列表\r\n  const doGetDiskList = (id) => {\r\n    setSelectLoading(true)\r\n    getDiskList(id).then(res => {\r\n      setSelectLoading(false)\r\n      setDiskList(res.data.list)\r\n      if (res.data.list[0]) {\r\n        setSForm({\r\n          ...sForm,\r\n          disk_id: Number(res.data.list[0].id),\r\n          id: id\r\n        });\r\n      } else {\r\n        setSForm({\r\n          ...sForm,\r\n          disk_id: null,\r\n          id\r\n        });\r\n      }\r\n    }).catch(error => {\r\n      setSelectLoading(false)\r\n    })\r\n  }\r\n  // 磁盘select改变 获取磁盘id\r\n  const getDiskIdValue = (e) => {\r\n    setSForm({\r\n      ...sForm,\r\n      disk_id: Number(e)\r\n    });\r\n  };\r\n  // 获取 快照名称\r\n  const getNameValue = (e) => {\r\n    setSForm({\r\n      ...sForm,\r\n      name: e.target.value,\r\n    })\r\n  }\r\n\r\n  // 打开创建快照弹窗\r\n  const showVisible = () => {\r\n\r\n    // 初始化 表单数据\r\n    setSForm({\r\n      id: cloudList[0] ? cloudList[0].id : null,\r\n      name: null,\r\n      disk_id: diskList[0] ? diskList[0].id : null\r\n    })\r\n    if (cloudList[0]) {\r\n      doGetDiskList(cloudList[0].id)\r\n    }\r\n    setErrMsg(\"\")\r\n    setVisible(true)\r\n  }\r\n\r\n\r\n  // 实例切换\r\n  const changeCloud = (e) => {\r\n    // 获取磁盘\r\n    doGetDiskList(e)\r\n  }\r\n\r\n  useEffect(() => {\r\n    getSnapshotList();\r\n    doGetCloudList()\r\n  }, [])\r\n\r\n  return (\r\n    <div className='Snapshot'>\r\n      <div className=\"top\">\r\n        <div className=\"top-text\">\r\n          快速将磁盘数据进行快照，一旦重装/实例删除，所有快照丢失\r\n        </div>\r\n        <div className=\"top-btn\" onClick={showVisible}>创建快照</div>\r\n      </div>\r\n      <div className=\"snapshot-table\">\r\n        <Table pagination={false} rowKey={record => record.id} loading={loading} columns={columns} dataSource={data}></Table>\r\n      </div>\r\n      {/* 创建快照弹窗 */}\r\n\r\n      <Modal\r\n        visible={visible}\r\n        footer={null}\r\n        centered={true}\r\n        closable={false}\r\n        style={{ borderRadius: \"10px\", overflow: \"auto\" }}\r\n        getContainer={false}\r\n        onCancel={() => setVisible(false)}\r\n      >\r\n        <div className='create-snapshot'>\r\n          <div className=\"top\">\r\n            <div className=\"title\">\r\n              创建快照\r\n            </div>\r\n          </div>\r\n          <div className=\"main\">\r\n            {\r\n              errMsg ?\r\n                <div className=\"err\">\r\n                  <Alert description={errMsg} type=\"error\" showIcon />\r\n                </div>\r\n                :\r\n                <div className=\"remind-text\">\r\n                  建议您关闭实例后创建快照，确保一致性避免出现问题，快照基于数量收费\r\n                </div>\r\n            }\r\n            <div className=\"form\">\r\n              <div className=\"row\">\r\n                <Row>\r\n                  <Col span={4}>\r\n                    <span className='label'>磁盘</span>\r\n                  </Col>\r\n                  <Col span={10}>\r\n                    <Select size='large'\r\n                      onChange={changeCloud}\r\n                      placeholder=\"请选择实例\"\r\n                      defaultValue={cloudList[0] ? cloudList[0].id : ''}\r\n                    >\r\n                      {\r\n                        cloudList.map(item => {\r\n                          return (<Option value={item.id} key={item.id}>{item.name}</Option>)\r\n                        })\r\n                      }\r\n                    </Select>\r\n                  </Col>\r\n                  <Col span={10}>\r\n                    <Select size='large' onChange={getDiskIdValue} value={sForm.disk_id} defaultValue={diskList[0] ? diskList[0].id : ''} placeholder=\"请选择磁盘\" loading={selectLoading}>\r\n                      {\r\n                        diskList.map(item => {\r\n                          return <Option key={item.id} value={item.id}>{`${item.name}-${item.size}G`}</Option>\r\n                        })\r\n                      }\r\n                    </Select>\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n              <div className=\"row\">\r\n                <Row>\r\n                  <Col span={4}>\r\n                    <span className='label'>名称</span>\r\n                  </Col>\r\n                  <Col span={20}>\r\n                    <Input size='large' placeholder=\"请输入快照名称\" onChange={getNameValue} />\r\n                  </Col>\r\n                </Row>\r\n              </div>\r\n            </div>\r\n          </div>\r\n          <div className=\"footer\">\r\n            <Button className='sub-btn' onClick={doCreateSnapshot} loading={createBtnLoading}>立即创建</Button>\r\n            <Button className='cancel-btn' onClick={() => setVisible(false)}>取消</Button>\r\n          </div>\r\n        </div>\r\n      </Modal>\r\n    </div>\r\n  )\r\n}\r\n"],"names":["getCloudListAll","request","getDiskList","id","snapshotList","createSnapshot","params","restoreSnapshot","delSnapshot","snapshot_id","backupList","delBackup","backup_id","restoreBackup","createBackup","templateList","createTemplate","delTemplate","template_id","isoList","Snapshot","t","useTranslation","Option","Select","useState","cloudList","setCloudList","diskList","setDiskList","name","disk_id","sForm","setSForm","selectLoading","setSelectLoading","createBtnLoading","setCreateBtnLoading","errMsg","setErrMsg","visible","setVisible","data","setData","columns","title","dataIndex","key","ellipsis","width","render","create_time","moment","format","minWidth","_","record","className","host_name","ip","src","country_code","require","alt","country","city","area","getPopupContainer","document","getElementById","content","onClick","recoverItem","deleteItem","placement","EllipsisOutlined","loading","setLoading","getSnapshotList","then","res","list","Swal","html","showCancelButton","confirmButtonColor","confirmButtonText","cancelButtonText","customClass","cancelButton","result","value","host_id","status","showDialog","catch","error","msg","console","log","icon","doDelBack","doGetDiskList","Number","useEffect","reverse","pagination","rowKey","dataSource","footer","centered","closable","style","borderRadius","overflow","getContainer","onCancel","description","type","showIcon","span","size","onChange","e","placeholder","defaultValue","map","item","target","isPass","length"],"sourceRoot":""}